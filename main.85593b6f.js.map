{"version":3,"sources":["AudioAPI/AudioAPI.ts","AudioAPI/index.ts","Visualizer/constants.ts","Visualizer/helpers/math.ts","Visualizer/helpers/color.ts","Visualizer/primitives/circle.ts","Visualizer/helpers/position.ts","Visualizer/Compositions/bubbleWorld.ts","Visualizer/primitives/strobe.ts","Visualizer/Visualizer.ts","Visualizer/index.ts","main.ts"],"names":[],"mappings":"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","file":"main.85593b6f.js","sourceRoot":"../src","sourcesContent":["export class AudioAPI {\n    private context: AudioContext;\n    private analyser: AnalyserNode;\n    private connectedNode: MediaStreamAudioSourceNode | null = null;\n    private analyserData: Float32Array;\n\n    constructor() {\n        this.context = new (window.AudioContext ||\n            (window as any).webkitAudioContext)();\n\n        this.analyser = this.context.createAnalyser();\n        this.analyserData = new Float32Array(this.analyser.frequencyBinCount);\n\n        this.requestPermissions();\n    }\n\n    public getAudioData = () => {\n        this.analyser.getFloatFrequencyData(this.analyserData);\n        return this.analyserData;\n    };\n\n    private connect = (connectedNode: MediaStreamAudioSourceNode) => {\n        this.connectedNode = connectedNode;\n        this.connectedNode.connect(this.analyser);\n    };\n\n    public releaseConnection = () => {\n        if (this.connectedNode) {\n            this.connectedNode.disconnect(this.analyser);\n        }\n    };\n\n    private requestPermissions = () => {\n        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n            navigator.mediaDevices.getUserMedia(\n                {\n                    audio: true,\n                    video: false\n                }\n            ).then(stream => {\n                const audioSource = this.context.createMediaStreamSource(stream);\n                this.connect(audioSource);\n            }).catch(console.log);\n        }\n    };\n}\n","export { AudioAPI } from './AudioAPI';","export const AUDIO_DATA_LENGTH = 1024;\n\nexport const WINDOW_WIDTH = window.innerWidth;\n\nexport const WINDOW_HEIGHT = window.innerHeight;\n\nexport const WINDOW_CENTER = {\n  X: WINDOW_WIDTH / 2,\n  Y: WINDOW_HEIGHT / 2\n};\n","const VALUE_INCREMENT = 130;\n\nexport function makePositive(value: number) {\n    value += VALUE_INCREMENT;\n\n    return !value || value < 0 ? 0 : value;\n}\n\nexport function random(min: number, max: number) {\n    return Math.random() * (max - min) + min;\n}","import { random } from \"./math\";\n\nexport const DEFAULT_COLOR = \"#FFFFFF\";\n\nexport enum Color {\n    Green = \"#5EBD3E\",\n    Yellow = \"#FFB900\",\n    Orange = \"#F78200\",\n    Red = \"#E23838\",\n    Purple = \"#973999\",\n    Blue = \"#009CDF\"\n};\n\nconst COLORS = [\n    Color.Green,\n    Color.Yellow,\n    Color.Orange,\n    Color.Red,\n    Color.Purple,\n    Color.Blue\n];\n\nexport function getRandomColor() {\n    return COLORS[Math.round(random(0, COLORS.length - 1))];\n}\n\nexport function getColorByKey(key: number) {\n    return COLORS[key % 6]\n}","import { WINDOW_CENTER } from \"../constants\";\nimport { DEFAULT_COLOR } from \"../helpers/color\";\n\nconst DATA_SCALE = 5;\n\ninterface ICircleProps {\n    x: number;\n    y: number;\n    radius: number;\n    color: string;\n    opacity?: number;\n}\n\nexport function drawCircle(ctx: CanvasRenderingContext2D, props: ICircleProps) {\n    const { x, y, radius, color, opacity = 1 } = props;\n\n    ctx.beginPath();\n    ctx.globalAlpha = opacity;\n    ctx.ellipse(x, y, radius, radius, 0, 0, 360);\n    ctx.fillStyle = color;\n    ctx.fill();\n    ctx.globalAlpha = 1;\n    ctx.closePath();\n}\n\nexport function drawMiddleCircle(\n    ctx: CanvasRenderingContext2D,\n    radius: number\n) {\n    drawCircle(ctx, {\n        x: WINDOW_CENTER.X,\n        y: WINDOW_CENTER.Y,\n        radius: radius * DATA_SCALE,\n        color: DEFAULT_COLOR\n    });\n}\n","import { WINDOW_WIDTH, WINDOW_HEIGHT } from \"../constants\";\nimport { random } from \"./math\";\n\nexport interface IPoint {\n    x: number;\n    y: number;\n}\n\nexport function getRandomPosition(): IPoint {\n    return {\n        x: random(0, WINDOW_WIDTH),\n        y: random(0, WINDOW_HEIGHT)\n    }\n}","import { drawCircle } from \"../primitives/circle\";\nimport { getRandomPosition, IPoint } from \"../helpers/position\";\nimport { makePositive, random } from \"../helpers/math\";\nimport { getRandomColor, DEFAULT_COLOR } from \"../helpers/color\";\n\nconst REPOSITION_FREQUENCY = 2;\nconst BUBBLE_COUNT = 30;\nconst LIFECYCLE_LENGTH = REPOSITION_FREQUENCY * BUBBLE_COUNT;\nlet CIRCLE_COORDS = randomizeCoords();\n\ninterface IScaledPoint extends IPoint {\n    scaleMultiplier: number;\n    color: string;\n}\n\nfunction randomizeCoords(): IScaledPoint[] {\n    let array: IScaledPoint[] = [];\n\n    for (let i = 0; i < BUBBLE_COUNT; i++) {\n        array.push({\n            ...getRandomPosition(),\n            scaleMultiplier: random(1, 5),\n            color: getRandomColor()\n        });\n    }\n\n    return array;\n}\n\nlet time = 0;\n\nfunction update() {\n    if(time === LIFECYCLE_LENGTH) {\n        time = 0;\n    } else {\n        time++\n    }\n\n    if(time % REPOSITION_FREQUENCY === 0) {\n        CIRCLE_COORDS[time / REPOSITION_FREQUENCY] = {\n            ...getRandomPosition(),\n            scaleMultiplier: random(1, 5),\n            color: getRandomColor()\n        }\n    }\n}\n\nfunction getOpacityByLifeCycleTime(time: number) {\n    if(time < LIFECYCLE_LENGTH / 2) {\n        return time * 2 / LIFECYCLE_LENGTH\n    } else {\n        return (LIFECYCLE_LENGTH - time) * 2 / LIFECYCLE_LENGTH\n    }\n}\n\nfunction getOpacityByIndex(index: number) {\n    let offsettedTime = time - index * REPOSITION_FREQUENCY;\n\n    if(offsettedTime < 0) {\n        offsettedTime += LIFECYCLE_LENGTH \n    }\n\n    return getOpacityByLifeCycleTime(offsettedTime);\n}\n\nexport function drawBubbleWorld(ctx: CanvasRenderingContext2D, data: Float32Array, colorized = false) {\n    update();\n\n    [0, 128, 256, 384, 512].forEach((freq, i) => {\n        for (let j = 0; j < 6; j++) {\n            const index = i * 6 + j,\n                { scaleMultiplier, color, ...coords } = CIRCLE_COORDS[index];\n\n            drawCircle(ctx, {\n                radius: makePositive(data[freq]) * scaleMultiplier,\n                ...coords,\n                color: colorized ? color : DEFAULT_COLOR,\n                opacity: getOpacityByIndex(index)\n            });\n        }\n    })\n}","import { WINDOW_WIDTH, WINDOW_HEIGHT } from \"../constants\";\nimport { DEFAULT_COLOR } from \"../helpers/color\";\n\nconst MIN_VALUE = -130,\n    MAX_VALUE = -40,\n    MIDDLE_VALUE = (MIN_VALUE + MAX_VALUE) / 2;\n\nfunction interpolateToOpacity(value: number) {\n    if(value > MIDDLE_VALUE) {\n        return (value - MIN_VALUE) / (MAX_VALUE - MIN_VALUE);\n    } else {\n        return 0;\n    }\n}\n\nexport function drawStrobe(ctx: CanvasRenderingContext2D, value: number) {\n    ctx.beginPath();\n    ctx.globalAlpha = interpolateToOpacity(value);\n    ctx.rect(0, 0, WINDOW_WIDTH, WINDOW_HEIGHT);\n    ctx.fillStyle = DEFAULT_COLOR;\n    ctx.fill();\n    ctx.globalAlpha = 1;\n    ctx.closePath();\n}","import { AudioAPI } from \"../AudioAPI\";\nimport { drawSpectrum } from \"./compositions/spectrum\";\nimport { WINDOW_WIDTH, WINDOW_HEIGHT } from \"./constants\";\nimport { drawMiddleCircle } from \"./primitives/circle\";\nimport { drawBubbleWorld } from \"./Compositions/bubbleWorld\";\nimport { makePositive } from \"./helpers/math\";\nimport { drawStrobe } from \"./primitives/strobe\";\n\nexport class Visualizer {\n    private ctx: CanvasRenderingContext2D;\n    private audioAPI: AudioAPI;\n\n    constructor(ctx: CanvasRenderingContext2D, audioAPI: AudioAPI) {\n        this.ctx = ctx;\n        this.audioAPI = audioAPI;\n\n        this.redraw();\n    }\n\n    getData = () => this.audioAPI.getAudioData();\n\n    getFreqValue = (freq: number) => {\n        return this.getData()[freq];\n    };\n\n    clearCanvas = () => {\n        const ctx = this.ctx;\n\n        ctx.clearRect(0, 0, WINDOW_WIDTH, WINDOW_HEIGHT);\n        \n        ctx.beginPath();\n        ctx.rect(0, 0, WINDOW_WIDTH, WINDOW_HEIGHT);\n        ctx.fillStyle = \"#000000\";\n        ctx.fill();\n        ctx.closePath();\n    }\n\n    redraw = () => {\n        this.clearCanvas();\n\n        // drawMiddleCircle(this.ctx, this.getFreqValue(6));\n        // drawSpectrum(this.ctx, this.getData());\n        drawStrobe(this.ctx, this.getFreqValue(6));\n        drawBubbleWorld(this.ctx, this.getData(), true);\n\n        requestAnimationFrame(this.redraw);\n    };\n}\n","export { Visualizer } from './Visualizer';","import { AudioAPI } from './AudioAPI';\nimport { Visualizer } from './Visualizer';\nimport { WINDOW_WIDTH, WINDOW_HEIGHT } from './Visualizer/constants';\n\nconst start = (ctx: CanvasRenderingContext2D) => {\n    const audioAPI = new AudioAPI();\n\n    const visualizer = new Visualizer(ctx, audioAPI);\n\n    return visualizer;\n}\n\nwindow.onload = () => {\n    const startButton = document.getElementById(\"start-button\"),\n        fullscreenButton = document.getElementById(\"fullscreen-button\"),\n        mainCanvas = document.getElementById(\"main-canvas\") as HTMLCanvasElement,\n        ctx = mainCanvas.getContext(\"2d\");\n\n    mainCanvas.width = WINDOW_WIDTH;\n    mainCanvas.height = WINDOW_HEIGHT;\n\n    startButton.addEventListener(\"click\", () => {\n        start(ctx);\n        startButton.remove();\n    });\n\n    fullscreenButton.addEventListener(\"click\", () => {\n        const canvas = mainCanvas as any;\n\n        if (canvas.webkitRequestFullScreen) {\n            canvas.webkitRequestFullScreen();\n        }\n        else {\n            canvas.mozRequestFullScreen();\n        }\n    });\n}"]}